<!DOCTYPE html>
<meta charset="utf-8">
<body>
<script src="//d3js.org/d3.v6.js"></script>
<script>

  // Adapted from Shan Carter's https://observablehq.com/@observablehq/simple-d3

const width = screen.width,
      height = screen.height;

///  this declaration just allows data to be accessed in getData() and updateAll()
let data;

const circleEnter = function(enter) {
  return enter    // https://www.createwithdata.com/enter-exit-with-d3-join/
    .append("circle")
    .attr("cx", d => d.cx)
    .attr("cy", d => d.cy)
    .attr("fill", d => d.fill)
    .attr("r", d => d.radius)    // will be inflated in 3000 milliseconds down below
}

const updateAll = function(nodes) {
  return svg
    .selectAll("circle")
    .data(nodes, function(d) {   // this keyFunction ensures bubbles stay consistent
      return d.bubble_id;    // id comes from MySQL DB bubbles.bubble_id
    })
    .join(circleEnter)    // https://www.createwithdata.com/enter-exit-with-d3-join/
}

// must be declared below definiton of mouseClickedSVG
const svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height);

// getData reads from DB via API
const getData = function() {
  const promisetToGetBubbles = d3.json("//ppcapi.robnugen.com/api/v1/get_bubbles/");
  promisetToGetBubbles.then(updateAll).catch(console.log.bind(console));  // h/t console bit https://pouchdb.com/2015/05/18/we-have-a-problem-with-promises.html
}();   // immediately call this function to load circles on screen.  OR  getData();

</script>
